# 🚀 数据标注平台快速启动指南

## 📋 概述

这是一个基于Streamlit开发的数据标注平台原型，支持多种数据类型的标注任务配置和执行。

## ⚡ 快速开始

### 1. 环境准备

```bash
# 确保Python版本 >= 3.8
python --version

# 安装依赖
pip install -r requirements.txt

# 或者直接安装主要依赖
pip install streamlit pandas openpyxl pillow markdown
```

### 2. 启动应用

```bash
# 在项目根目录运行
streamlit run streamlit_app.py
```

应用将在 http://localhost:8501 启动

### 3. 首次使用

1. **访问首页** - 查看系统概览
2. **创建任务** - 导航到"任务配置"页面
3. **上传数据** - 使用提供的测试数据或自己的JSONL文件
4. **开始标注** - 切换到"数据标注"页面
5. **查看进度** - 在"进度管理"页面监控标注进度
6. **导出结果** - 在"结果导出"页面下载标注结果

## 📊 测试数据

项目提供了三种类型的测试数据：

### SQL语义一致性标注
```bash
# 使用文件: test_data/sql_sample.jsonl
# 标注类型: 单选 (True/False)
# 字段配置:
# - question: text
# - sql: code (语言: sql)  
# - result: text
```

### 数学题标注
```bash
# 使用文件: test_data/math_sample.jsonl
# 标注类型: 多级标注 (单选 + 条件文本输入)
# 字段配置:
# - problem: text
# - answer: text
# - pdf_path: pdf
# - difficulty: text
```

### 研究报告评估
```bash
# 使用文件: test_data/deepresearch_sample.jsonl
# 标注类型: 评分 (1-10)
# 字段配置:
# - question: text
# - report_path: markdown
# - rubrics_path: text
# - model_score_path: text
```

## 🎯 功能特性

### ✅ 支持的数据类型
- 📄 **文本** - 普通文本显示
- 💻 **代码** - 语法高亮 (SQL, Python, JavaScript等)
- 🖼️ **图片** - 图片文件预览 (.jpg, .png, .gif等)
- 📄 **PDF** - PDF文档下载链接
- 📝 **Markdown** - 富文本渲染

### ✅ 支持的标注形式
- 🔘 **单选** - 从预定义选项中选择一个
- ☑️ **多选** - 从预定义选项中选择多个
- ⭐ **评分** - 数值评分 (可自定义范围)
- ✏️ **文本输入** - 自由文本输入

### ✅ 核心功能
- 📁 **任务配置** - 灵活的任务创建和配置
- 📝 **数据标注** - 直观的标注界面
- 📊 **进度管理** - 实时进度跟踪
- 📤 **结果导出** - 多格式数据导出 (JSON, JSONL, CSV, Excel)

## 📝 使用示例

### 示例1: 创建SQL语义标注任务

1. **上传数据文件**
   - 选择 `test_data/sql_sample.jsonl`
   - 查看数据预览，确认10条数据加载成功

2. **配置显示字段**
   - 选择字段: question, sql, result
   - 设置类型: 
     - question → text
     - sql → code (language: sql)
     - result → text

3. **配置标注内容**
   - 标注形式: 单选
   - 选项: True, False
   - 标注说明: "请判断SQL查询与问题描述的语义是否一致"

4. **创建任务**
   - 任务名称: "SQL语义一致性验证"
   - 任务描述: "验证SQL查询是否正确回答了给定问题"

### 示例2: 执行标注工作

1. **选择任务**
   - 在"数据标注"页面选择刚创建的任务

2. **开始标注**
   - 查看当前数据内容 (问题、SQL代码、执行结果)
   - 根据标注说明判断语义一致性
   - 选择 True 或 False
   - 点击"保存标注"

3. **导航操作**
   - 使用"下一条"/"上一条"浏览数据
   - 使用跳转功能快速定位
   - 随时修改已标注的内容

### 示例3: 导出标注结果

1. **查看进度**
   - 在"进度管理"页面查看标注进度

2. **导出数据**
   - 在"结果导出"页面选择任务
   - 选择导出格式 (推荐JSON或JSONL)
   - 设置导出选项 (包含原始数据、仅已完成等)
   - 下载导出文件

## 🔧 配置说明

### 数据文件格式

JSONL文件要求：
```jsonl
{"field1": "value1", "field2": "value2", "field3": "value3"}
{"field1": "value4", "field2": "value5", "field3": "value6"}
```

每行必须是有效的JSON对象，字段名称和类型可以灵活定义。

### 文件路径处理

如果数据中包含文件路径引用：
```json
{"text": "这是文本", "image_path": "images/example.jpg"}
```

在字段配置时：
1. 设置 `image_path` 字段类型为 `image`
2. 如果使用相对路径，在上传时指定"基础路径"
3. 系统会自动验证文件是否存在

### 标注配置建议

**单选配置**:
```
选项示例:
True
False
```

**多选配置**:
```
选项示例:
相关
不相关
需要修改
质量良好
```

**评分配置**:
- 最小值: 1
- 最大值: 10
- 适用于质量评估、满意度等

**文本输入配置**:
- 提示文本: "请输入修改建议"
- 适用于开放性问题、意见收集等

## 🗂️ 数据管理

### 数据存储位置

```
项目根目录/
├── annotation_platform.db    # SQLite数据库文件
├── data/                     # 任务数据文件目录
│   ├── task_data_xxx.jsonl   # 自动生成的任务数据文件
│   └── ...
└── test_data/               # 测试数据目录
```

### 数据备份

```bash
# 备份数据库
cp annotation_platform.db backup_$(date +%Y%m%d_%H%M%S).db

# 备份任务数据
tar -czf data_backup_$(date +%Y%m%d_%H%M%S).tar.gz data/
```

## 🛠️ 故障排除

### 常见问题

**Q: 上传文件后显示解析错误**
```
A: 检查JSONL文件格式，确保每行都是有效JSON
   使用在线JSON验证器检查格式
```

**Q: 图片/PDF文件显示"文件不存在"**
```
A: 确认文件路径正确，检查基础路径设置
   使用绝对路径或确保相对路径相对于基础路径正确
```

**Q: 标注保存后丢失**
```
A: 检查数据库文件权限
   确保有写入权限
   查看浏览器控制台是否有错误信息
```

**Q: 应用启动失败**
```
A: 检查Python版本 (需要>=3.8)
   确认所有依赖已正确安装
   查看错误信息并安装缺失的包
```

### 性能优化

**大文件处理**:
- 建议单个JSONL文件不超过10MB
- 数据量超过1000条时考虑分批处理

**浏览器兼容性**:
- 推荐使用Chrome、Firefox、Safari最新版本
- 确保JavaScript已启用

**网络要求**:
- 本地运行无特殊网络要求
- 如需远程访问，考虑使用streamlit的sharing功能

## 📈 性能指标

### 预期性能
- **文件上传**: 1MB文件 < 10秒
- **页面响应**: 标注界面切换 < 2秒  
- **数据保存**: 标注保存 < 1秒
- **并发用户**: 支持10+用户同时使用

### 数据规模支持
- **单个任务**: 最多10,000条数据
- **并发任务**: 无限制
- **用户数据**: 无限制 (受存储空间限制)

## 🔄 版本升级

从原型升级到生产系统时：

1. **数据迁移**: 导出所有标注结果
2. **配置备份**: 保存任务配置信息  
3. **用户培训**: 新系统使用培训
4. **逐步切换**: 并行运行确保稳定性

## 📞 技术支持

如遇到问题或需要功能扩展：

1. **查看日志**: 检查Streamlit控制台输出
2. **检查数据库**: 使用SQLite工具查看数据
3. **重启应用**: 简单重启可解决大部分问题
4. **清理缓存**: 删除浏览器缓存和临时文件

---

🎉 **恭喜！** 你已经成功启动了数据标注平台。现在可以开始创建你的第一个标注任务了！
